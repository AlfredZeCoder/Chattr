<div class="container">
    <div class="chat-container">
        <div class="conversations-container">
            <div class="search-bar-container">
                <div class="search-bar">
                    @if (!hasClickedAddingUser) {
                    <input [(ngModel)]="searchUser" type="text"
                        [ngStyle]="{'width' : isAddingUser ? '0%' : '90%', 'transition' : 'width 0.3s ease-in-out' }"
                        class="search" placeholder="Search" />
                    <mat-icon [ngStyle]="{'margin-left' : isAddingUser ? '280px' : null, 'transition' : 'margin 0.3s'}"
                        class="icon" svgIcon="new-message" (click)="addingUser()"></mat-icon>
                    } @else {
                    <input [(ngModel)]="searchAddUser" type="text" class="search"
                        [ngStyle]="{'width' : !isAddingUser ? '0%' : '90%', 'transition' : 'width 0.3s ease-in-out' }"
                        placeholder="Enter the email of the user you want to add" />
                    <mat-icon [ngStyle]="{'margin-left' : !isAddingUser ? '280px' : null, 'transition' : 'margin 0.3s'}"
                        class="icon" svgIcon="close" (click)="addingUser()"></mat-icon>
                    }
                </div>
            </div>
            <div class="conversations">
                @for (conversation of conversations; track conversation) {
                @if (conversation.userName.toLowerCase().startsWith(searchUser.toLowerCase())) {
                <div class="conversation" (click)="getConversation(conversation)"
                    [ngStyle]="{ 'background-color': hasClickedConversation && conversation.id == clickedConversationId ? 'var(--soft-black)' : null }">
                    <div class="name-and-time">
                        <div class="name"
                            [ngStyle]="{ 'color': hasClickedConversation && conversation.id == clickedConversationId ? 'rgb(218, 220, 224)' : null }">
                            {{ conversation.userName }}
                        </div>
                        <div class="time"
                            [ngStyle]="{ 'color': hasClickedConversation && conversation.id == clickedConversationId ? 'rgb(218, 220, 224)' : null }">
                            @if (!isYesterday(conversation.timestamp)) {
                            {{ conversation.timestamp | date: 'shortTime' }}
                            } @else if (isYesterday(conversation.timestamp)) {
                            Yesterday
                            } @else {
                            {{ conversation.timestamp | date: 'shortDate' }}
                            }
                        </div>
                    </div>
                    <div class="last-message" [ngStyle]="changeLastMessageColor(conversation)">
                        @if (!conversation.lastMessageIsRead && conversation.lastMessage){
                        <div class="unread-dot"></div>
                        }
                        {{ conversation.lastMessage | truncate: 25 }}
                    </div>
                </div>
                }
                }
            </div>
        </div>
        <div class="chat">
            @if (hasClickedConversation) {
            <app-message [conversation]="inputConversation"></app-message>
            }
        </div>
    </div>
</div>